<?xml version="1.0" encoding="UTF-8" ?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
    <sampleQuery>select * from {table} where episodeid="310032"</sampleQuery>
    <description>Retrieve TV episode details from TVDB. See http://stackoverflow.com/questions/3292899/tailoring-the-output-of-yql</description>
    <author>Peter Cowburn &amp; JP Hastings-Spital</author>
  </meta>
  <bindings>
    <select itemPath="video" produces="XML">
      <inputs>
        <key id="episodeid" type="xs:string" paramType="variable" required="true"/>
      </inputs>
      <execute><![CDATA[
// Peter, you rock!
var query = 'select * from xml where url="http://www.thetvdb.com/api/{apikey}/episodes/'+episodeid+'" and itemPath="/Data/Episode"';

var result = y.query(query).results;
var video = <video/>;

// The title can span multiple lines, lets remove breaks.
var title = result.a.text().toString().replace(/\s+/g, ' ');

// The year
var year = result.h3.text().toString();

// The poster
var poster = result.img.@['src'].toString();

video.node += <title>{title} {year}</title>;
video.node += <poster>{poster}</poster>
video.node += <id>tmdb:{movieid}</id>

response.object = video;
]]></execute>
    </select>
  </bindings>
</table>